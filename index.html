<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Pro Studio v2.2 — Mobile + PC Optimized — by n1s4t</title>

<!-- Tailwind (CDN) -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- Lightweight defaults; heavy libs are lazy-loaded -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" />

<style>
  :root{ --glass: rgba(255,255,255,0.04); --touch:44px; }
  html,body{height:100%;font-family:Inter,system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:linear-gradient(180deg,#071029,#050511); color:#e6eef8;}
  .glass{backdrop-filter: blur(6px); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; border:1px solid rgba(255,255,255,0.04);}
  .panel{border-radius:14px; overflow:hidden; box-shadow: 0 8px 24px rgba(2,6,23,0.6);}
  .code-editor{font-family: ui-monospace,SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; min-height:360px; white-space:pre-wrap; outline:none; padding:14px; font-size:14px;}
  .divider{width:10px; cursor: col-resize; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px;}
  .fab{width:52px; height:52px; border-radius:9999px; display:grid; place-items:center; box-shadow: 0 10px 26px rgba(2,6,23,0.6); overflow:hidden;}
  .fab .ripple{position:absolute; inset:0; transform:scale(0); background: radial-gradient(circle, rgba(255,255,255,0.12), transparent 40%); transition: transform .45s cubic-bezier(.2,.8,.2,1);}
  .fab:active .ripple{transform:scale(2);}
  .tab{padding:6px 12px; border-radius:10px; cursor:pointer; font-size:13px;}
  .tab.active{background:linear-gradient(90deg,#7c3aed,#ec4899); color:white;}
  .pill{padding:8px 12px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;}
  .glass-btn{padding:8px 12px; border-radius:999px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); font-size:13px;}
  .mobile-nav{display:none;}
  .hidden{display:none;}
  @media (max-width:900px){
    .cols-3{grid-template-columns:1fr;}
    .divider{display:none;}
    .mobile-nav{display:flex; position:fixed; bottom:0; left:0; right:0; gap:6px; padding:8px; background:linear-gradient(180deg,#020617,#061022); z-index:60; justify-content:space-around; align-items:center;}
    .fab-group{right:16px; bottom:80px;}
    .code-editor{min-height:56vh; padding:12px; font-size:15px;}
    header .desktop-only{display:none;}
  }
  /* touch-friendly targets */
  button, input, select { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
</style>
</head>
<body class="p-4">

<!-- Header -->
<header class="flex items-center justify-between mb-4">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-md glass flex items-center justify-center">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3 12h18" stroke="#fff" stroke-width="1.4" stroke-linecap="round"/><path d="M12 3v18" stroke="#fff" stroke-width="1.4" stroke-linecap="round"/></svg>
    </div>
    <div>
      <h1 class="text-lg font-bold">Pro Studio v2.2 <span class="text-xs text-indigo-300 desktop-only">by n1s4t</span></h1>
      <p class="text-xs text-gray-300 desktop-only">Markdown · HTML · DOCX — responsive & touch-optimized</p>
    </div>
  </div>

  <div class="flex items-center gap-2">
    <select id="themeSelect" class="glass-btn desktop-only">
      <option value="dark" selected>Dark</option>
      <option value="light">Light</option>
      <option value="dracula">Dracula</option>
      <option value="cyber">Cyberpunk</option>
    </select>

    <div class="glass-btn desktop-only">
      <label class="inline-flex items-center gap-2 text-sm"><input id="autoSync" type="checkbox" checked> Auto-sync</label>
    </div>

    <div class="glass-btn">
      <span class="text-xs text-gray-300">Files:</span>
      <div id="tabs" class="inline-flex gap-2 ml-2"></div>
      <button id="newTabBtn" class="ml-2 glass-btn">+ New</button>
    </div>
  </div>
</header>

<!-- Main -->
<main id="mainGrid" class="grid cols-3 grid-cols-[1fr_10px_1fr_10px_1fr] gap-4 mb-18">

  <!-- HTML -->
  <section id="htmlSection" class="panel glass p-3">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center gap-2"><strong>HTML</strong><span id="htmlStats" class="text-xs text-gray-300">0 • 0</span></div>
      <div class="flex items-center gap-2 desktop-only">
        <button id="htmlSearchBtn" class="glass-btn">Search</button>
        <button id="formatHtml" class="glass-btn">Format</button>
      </div>
    </div>
    <pre id="htmlPane" class="code-editor language-xml" contenteditable="true" spellcheck="false" aria-label="HTML editor"></pre>
  </section>

  <div id="divider1" class="divider" title="Drag to resize"></div>

  <!-- Markdown -->
  <section id="mdSection" class="panel glass p-3">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center gap-2"><strong>Markdown</strong><span id="mdStats" class="text-xs text-gray-300">0 • 0</span></div>
      <div class="flex items-center gap-2 desktop-only">
        <button id="mdSearchBtn" class="glass-btn">Search</button>
        <button id="boldBtn" class="glass-btn">B</button>
        <button id="italicBtn" class="glass-btn">I</button>
      </div>
    </div>
    <pre id="mdPane" class="code-editor language-markdown" contenteditable="true" spellcheck="false" aria-label="Markdown editor"></pre>
  </section>

  <div id="divider2" class="divider" title="Drag to resize"></div>

  <!-- Preview -->
  <section id="previewSection" class="panel glass p-3">
    <div class="flex items-center justify-between mb-2">
      <strong>Preview</strong>
      <div class="text-xs text-gray-300" id="previewInfo">Live</div>
    </div>
    <div id="previewPane" class="prose max-w-none p-2 min-h-[220px] bg-[#020617] rounded"></div>
  </section>
</main>

<!-- Mobile nav -->
<nav class="mobile-nav rounded-t-lg shadow-lg">
  <button id="navHtml" class="flex-1 text-center py-2 text-sm">HTML</button>
  <button id="navMd" class="flex-1 text-center py-2 text-sm">Markdown</button>
  <button id="navPreview" class="flex-1 text-center py-2 text-sm">Preview</button>
</nav>

<!-- FAB group -->
<div class="fab-group fixed right-6 bottom-20 flex flex-col gap-3 z-50">
  <div id="fabMenuToggle" class="fab bg-indigo-500 text-white" title="Actions">
    <span class="ripple"></span>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 5v14" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/><path d="M5 12h14" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/></svg>
  </div>
  <div id="fabMenu" class="hidden flex flex-col gap-3">
    <button id="downloadFab" class="fab bg-gradient-to-br from-indigo-500 to-pink-500 text-white" title="Download"><span class="ripple"></span>↓</button>
    <button id="copyFab" class="fab bg-green-500 text-white" title="Copy"><span class="ripple"></span>⧉</button>
    <button id="exportAsBtn" class="fab bg-sky-500 text-white" title="Export As"><span class="ripple"></span>⋯</button>
    <button id="clearFab" class="fab bg-red-500 text-white" title="Clear"><span class="ripple"></span>✖</button>
  </div>
</div>

<!-- Export sheet (mobile friendly) -->
<div id="exportSheet" class="hidden fixed left-1/2 -translate-x-1/2 bottom-28 w-[90%] bg-[#071022] p-3 rounded-lg glass border border-white/5 shadow-lg z-60">
  <div class="text-sm text-gray-300 mb-2">Export as</div>
  <div class="grid grid-cols-2 gap-2">
    <button data-ext="md" class="glass-btn exportChoice">Markdown (.md)</button>
    <button data-ext="html" class="glass-btn exportChoice">HTML (.html)</button>
    <button data-ext="txt" class="glass-btn exportChoice">Text (.txt)</button>
    <button data-ext="docx" class="glass-btn exportChoice">Word (.docx)</button>
    <button data-ext="pdf" class="glass-btn exportChoice col-span-2">PDF (.pdf)</button>
  </div>
</div>

<!-- Search modal -->
<div id="searchModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 z-70">
  <div class="bg-white text-black rounded-lg p-4 w-[min(720px,95%)]">
    <div class="flex items-center gap-2">
      <input id="searchInput" placeholder="Find..." class="flex-1 p-2 border rounded" />
      <input id="replaceInput" placeholder="Replace..." class="p-2 border rounded" />
      <button id="doReplace" class="px-3 py-2 bg-indigo-600 text-white rounded">Replace</button>
      <button id="closeSearch" class="px-3 py-2 border rounded">Close</button>
    </div>
    <div class="mt-2 text-sm text-gray-600">Use Enter to find next, Shift+Enter to find previous.</div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-6 bg-black/80 text-white px-4 py-2 rounded opacity-0 transition-opacity z-80"></div>

<!-- Lazy load scripts: heavy libs will be requested only when needed -->
<script>
function lazyLoadScript(src, onload){ if(window.loadedScripts && window.loadedScripts[src]){ if(onload) onload(); return; } const s=document.createElement('script'); s.src=src; s.onload=()=>{ window.loadedScripts=window.loadedScripts||{}; window.loadedScripts[src]=true; if(onload) onload(); }; document.head.appendChild(s); }

/* DOM refs */
const htmlPane = document.getElementById('htmlPane');
const mdPane = document.getElementById('mdPane');
const previewPane = document.getElementById('previewPane');
const autoSync = document.getElementById('autoSync');
const themeSelect = document.getElementById('themeSelect');
const htmlStats = document.getElementById('htmlStats');
const mdStats = document.getElementById('mdStats');
const toast = document.getElementById('toast');
const fileInput = (()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='.md,.markdown,.html,.txt,.docx'; inp.className='hidden'; document.body.appendChild(inp); return inp; })();
const importBtn = document.querySelector('button[title="Import"]') || document.getElementById('importBtn');

/* Tabs */
const tabsEl = document.getElementById('tabs');
let files = JSON.parse(localStorage.getItem('ps_files_v22') || '[]');
if(!files.length) files = [{id:Date.now(), name:'untitled.md', html:'', md:''}];
let activeFile = files[0].id;
function renderTabs(){ tabsEl.innerHTML=''; files.forEach(f=>{ const btn=document.createElement('div'); btn.className='tab ' + (f.id===activeFile?'active':''); btn.textContent=f.name; btn.onclick=()=>{ activeFile=f.id; loadActive(); renderTabs(); }; tabsEl.appendChild(btn); }); }
renderTabs();
function saveFiles(){ localStorage.setItem('ps_files_v22', JSON.stringify(files)); }
function loadActive(){ const f=files.find(x=>x.id===activeFile); if(!f) return; htmlPane.innerText=f.html||''; mdPane.innerText=f.md||''; syncAll(false); }
document.getElementById('newTabBtn').onclick = ()=>{ const f={id:Date.now(), name:'untitled.md', html:'', md:''}; files.push(f); activeFile=f.id; saveFiles(); renderTabs(); loadActive(); };

/* converters (lazy) */
let turndownService = null, showdownConverter = null, mammothLoaded=false, docxLoaded=false;
function ensureMarkdownConverters(cb){
  if(showdownConverter && turndownService){ if(cb) cb(); return; }
  lazyLoadScript('https://unpkg.com/turndown/dist/turndown.js', ()=>{ turndownService = new TurndownService(); lazyLoadScript('https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js', ()=> turndownService.use(turndownPluginGfm.gfm)); });
  lazyLoadScript('https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js', ()=>{ showdownConverter = new showdown.Converter({tables:true, ghCodeBlocks:true}); if(cb) cb(); });
}

/* stats */
function statsFor(text){ const lines=text.split('\n').length; const words=text.split(/\s+/).filter(Boolean).length; return {lines,words}; }
function updateStats(){ htmlStats.textContent=`${statsFor(htmlPane.innerText).lines} • ${statsFor(htmlPane.innerText).words}`; mdStats.textContent=`${statsFor(mdPane.innerText).lines} • ${statsFor(mdPane.innerText).words}`; }

/* sync logic */
let lastMd='', lastHtml='';
function syncAll(save=true){
  ensureMarkdownConverters(()=>{
    if(autoSync && autoSync.checked){
      const md=mdPane.innerText;
      if(md!==lastMd){
        const html = showdownConverter.makeHtml(md);
        htmlPane.innerText = html;
        previewPane.innerHTML = html;
        lastMd=md; lastHtml=html;
      } else {
        const html = htmlPane.innerText;
        if(html!==lastHtml && turndownService){
          const md2 = turndownService.turndown(html);
          mdPane.innerText = md2;
          previewPane.innerHTML = html;
          lastHtml = html; lastMd = md2;
        } else {
          previewPane.innerHTML = htmlPane.innerText;
        }
      }
    } else {
      if(htmlPane.innerText.trim()) previewPane.innerHTML = htmlPane.innerText;
      else previewPane.innerHTML = showdownConverter ? showdownConverter.makeHtml(mdPane.innerText) : mdPane.innerText;
    }
    updateStats();
    if(save){ const f=files.find(x=>x.id===activeFile); if(f){ f.html=htmlPane.innerText; f.md=mdPane.innerText; saveFiles(); } }
    if(window.hljs) window.hljs.highlightAll();
  });
}

/* input events */
[htmlPane, mdPane].forEach(p=> p.addEventListener('input', ()=> syncAll()));

/* import handling (uses mammoth lazily for docx) */
importBtn && (importBtn.onclick = ()=> fileInput.click());
fileInput.addEventListener('change', async (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const text = await file.text().catch(()=>null);
  const ext = (file.name.split('.').pop()||'').toLowerCase();
  const f = files.find(x=>x.id===activeFile);
  if(ext==='html' || ext==='htm'){ f.html = text || ''; ensureMarkdownConverters(()=> f.md = turndownService.turndown(f.html)); }
  else if(ext==='md' || ext==='markdown' || ext==='txt'){ f.md = text || ''; ensureMarkdownConverters(()=> f.html = showdownConverter.makeHtml(f.md)); }
  else if(ext==='docx'){
    if(!mammothLoaded){ await new Promise(res=> lazyLoadScript('https://unpkg.com/mammoth/mammoth.browser.min.js', ()=>{ mammothLoaded=true; res(); })); }
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.convertToHtml({arrayBuffer});
    f.html = result.value || '';
    ensureMarkdownConverters(()=> f.md = turndownService.turndown(f.html));
  } else { showToast('Unsupported format'); return; }
  saveFiles(); loadActive(); showToast('Imported '+file.name);
});

/* resizing (desktop) */
function makeDivider(div){ let dragging=false; div.addEventListener('pointerdown', (e)=>{ dragging=true; div.setPointerCapture(e.pointerId); }); window.addEventListener('pointerup', ()=>{ dragging=false; }); window.addEventListener('pointermove', (e)=>{ if(!dragging) return; const grid=document.getElementById('mainGrid'); const rect=grid.getBoundingClientRect(); const x=e.clientX-rect.left; const total=rect.width; const col0=Math.max(220, x-8); const col2=Math.max(220, total-col0-20-220); grid.style.gridTemplateColumns = `${col0}px 10px ${col2}px 10px 1fr`; }); }
makeDivider(document.getElementById('divider1')); makeDivider(document.getElementById('divider2'));

/* FAB actions & export (uses docx lazy) */
function showToast(msg){ toast.textContent=msg; toast.style.opacity=1; setTimeout(()=>{ toast.style.opacity=0; }, 2100); }
document.getElementById('downloadFab').onclick = ()=> { const f=files.find(x=>x.id===activeFile); const name=f.name||'export.md'; const ext = name.split('.').pop()||'md'; let content = ext==='html' ? (htmlPane.innerText||'') : (mdPane.innerText||htmlPane.innerText); const blob = new Blob([content], {type:'text/plain;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href); showToast('Downloaded '+name); };
document.getElementById('copyFab').onclick = async ()=>{ try{ await navigator.clipboard.writeText(mdPane.innerText || htmlPane.innerText); showToast('Copied'); }catch(e){ showToast('Copy failed'); } };
document.getElementById('clearFab').onclick = ()=>{ if(!confirm('Clear current file?')) return; htmlPane.innerText=''; mdPane.innerText=''; previewPane.innerHTML=''; syncAll(); };
const exportSheet = document.getElementById('exportSheet');
document.getElementById('exportAsBtn').onclick = ()=> exportSheet.classList.toggle('hidden');

/* export choices */
document.querySelectorAll('.exportChoice').forEach(btn=> btn.onclick = async (e)=>{
  const ext=e.currentTarget.dataset.ext; const f=files.find(x=>x.id===activeFile); const base=(f.name||'export').replace(/\.[^/.]+$/,'');
  if(ext==='md'){ const blob=new Blob([mdPane.innerText||''],{type:'text/markdown'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=base+'.md'; a.click(); URL.revokeObjectURL(a.href); showToast('Exported .md'); }
  else if(ext==='html'){ const blob=new Blob([htmlPane.innerText||''],{type:'text/html'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=base+'.html'; a.click(); URL.revokeObjectURL(a.href); showToast('Exported .html'); }
  else if(ext==='txt'){ const blob=new Blob([mdPane.innerText||htmlPane.innerText||''],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=base+'.txt'; a.click(); URL.revokeObjectURL(a.href); showToast('Exported .txt'); }
  else if(ext==='docx'){
    if(!window.docx){ await new Promise(res=> lazyLoadScript('https://unpkg.com/docx@7.7.0/build/index.browser.js', ()=> res())); }
    try{
      const mdText = mdPane.innerText || (turndownService ? turndownService.turndown(htmlPane.innerText||'') : htmlPane.innerText||'');
      const paragraphs = mdText.split(/\n+/).map(ln => new window.docx.Paragraph({ children: [ new window.docx.TextRun(ln) ] }));
      const doc = new window.docx.Document({ sections: [{ properties: {}, children: paragraphs }] });
      const blob = await window.docx.Packer.toBlob(doc);
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=base+'.docx'; a.click(); URL.revokeObjectURL(a.href);
      showToast('Exported .docx');
    }catch(err){ console.error(err); showToast('DOCX export failed'); }
  } else if(ext==='pdf'){
    const w=window.open('','_blank','width=900,height=700'); const html=previewPane.innerHTML; w.document.write(`<html><head><title>Export PDF</title><style>body{font-family:Inter,Arial;padding:20px;color:#111}</style></head><body>${html}</body></html>`); w.document.close(); w.focus(); w.print(); showToast('Print dialog opened'); }
  exportSheet.classList.add('hidden');
});

/* FAB menu toggle */
document.getElementById('fabMenuToggle').onclick = ()=> document.getElementById('fabMenu').classList.toggle('hidden');

/* mobile navigation */
document.getElementById('navHtml').onclick = ()=> { showPanel('html'); };
document.getElementById('navMd').onclick = ()=> { showPanel('md'); };
document.getElementById('navPreview').onclick = ()=> { showPanel('preview'); };

function showPanel(p){ if(window.innerWidth > 900) return; document.getElementById('htmlSection').style.display = p==='html' ? 'block' : 'none'; document.getElementById('mdSection').style.display = p==='md' ? 'block' : 'none'; document.getElementById('previewSection').style.display = p==='preview' ? 'block' : 'none'; }

/* keyboard shortcuts (desktop) */
window.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); syncAll(); showToast('Saved'); } if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='b'){ e.preventDefault(); document.execCommand('insertText', false, '**bold**'); } });

/* search modal (simple replace) */
const searchModal = document.getElementById('searchModal');
document.getElementById('htmlSearchBtn')?.addEventListener('click', ()=> openSearch(htmlPane));
document.getElementById('mdSearchBtn')?.addEventListener('click', ()=> openSearch(mdPane));
let activeSearchTarget = null;
function openSearch(target){ activeSearchTarget=target; searchModal.classList.remove('hidden'); searchModal.classList.add('flex'); document.getElementById('searchInput').focus(); }
document.getElementById('closeSearch').onclick = ()=> { searchModal.classList.add('hidden'); activeSearchTarget=null; };
document.getElementById('doReplace').onclick = ()=> { const find=document.getElementById('searchInput').value; const replace=document.getElementById('replaceInput').value; if(!find) return; activeSearchTarget.innerText = activeSearchTarget.innerText.split(find).join(replace); syncAll(); showToast('Replaced'); };

/* formatting */
document.getElementById('boldBtn')?.addEventListener('click', ()=> document.execCommand('insertText', false, '**bold**'));
document.getElementById('italicBtn')?.addEventListener('click', ()=> document.execCommand('insertText', false, '*italic*'));

/* finalize: load initial converters on desktop for better UX */
if(window.innerWidth > 900) { lazyLoadScript('https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js', ()=>{ lazyLoadScript('https://unpkg.com/turndown/dist/turndown.js', ()=>{ lazyLoadScript('https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js', ()=>{ syncAll(false); }); }); }); } else { syncAll(false); }

/* save on unload */
window.addEventListener('beforeunload', ()=> syncAll());
</script>
</body>
</html>
